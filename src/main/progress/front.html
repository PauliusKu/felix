<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>Felix XREF analyser</title>
        <link rel="stylesheet" href="/felix/master.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <script src="/felix/dropdown.js" type="text/javascript"></script>

        <SCRIPT LANGUAGE="SpeedScript">
            CREATE WIDGET-POOL.
        </SCRIPT>

    </head>
    <body>

        <script language="speedscript">
            {ttDetails.i}
            define variable cName as character no-undo.
            define variable iType as integer no-undo.
            define variable cSystem as character no-undo.
            define variable lDetails as logical init false no-undo.
            
            function countEntries returns integer (input table ttDetails):
                define variable iCount as integer no-undo init 0.    
                for each ttDetails:
                    iCount = iCount + 1.
                end.
                return iCount.
            end.


            cName = get-field('name':U).
            iType = integer(get-field('type':U)).
            cSystem = get-field('system':U).
            if get-field('details':U) <> "" then
                lDetails = logical(get-field('details':U), "yes/no").

        </script>

        <!--WSS if cName = "" then do: -->

        <div class="container">
            <div class="form-container">
                <img id="giffy" src="/felix/giphy.gif" alt="Felix" width="200" heigth="200">
                <h1><span id="logo">Felix<sup>&reg</sup></span> XREF analyser</h1>
                <p>This service analyses Your compilation reference information on ABL elements, cross-references between procedures and ABL objects, and cross-references between class or interface definition files and ABL objects.</p>
                <p>Output shows all references of one specific program's element within the application's filesystem.</p>
                <br>

                <form class="form-group" id="xrefForm" action="front.html" method="POST">
                    <h3>Please enter searched element by type and name.</h3>
                    <label for="type">Type:</label><br>
                    <select id="inpType" class="form-control" name="type">
                        <option value="0">Select ...</option>
                        <option value="1">Procedure</option>
                        <option value="2">Class</option>
                        <option value="3">Include</option>
                        <option value="4" disabled>DB field</option>
                        <option value="5" disabled>Index</option>
                    </select><br>
                    <div id="invFeedbackType" class="invalid-feedback">
                        Please enter type.
                    </div>
                    <label for="name">Name:</label>
                    <input id="inpName" autocomplete="off" type="text" class="form-control" 
                        name="name" value="" placeholder="please enter name" required>
                    <ul id="autocomplete"></ul>
                    <input id="inpDetails" type="hidden" name="details" value="no">
                    <div id="invFeedbackName" class="invalid-feedback">
                        Please enter name.
                    </div>
                    <br>
                    <label for="system">System:</label>
                    <input id="sysName" autocomplete="off" type="text" class="form-control" 
                        name="system" value="" placeholder="please enter system name" required>
                    <ul id="autocomplete"></ul>
                    <input id="inpDetails" type="hidden" name="details" value="no">
                    <div id="invFeedbackName" class="invalid-feedback">
                        Please enter system name.
                    </div>
                    <br>
                    <button id="xrefFormButton" type="submit" 
                        class="xrefbutton btn btn-primary">Submit</button>
                </form>
                <div class="outputMessage"></div>
            </div>
        </div>

        <!--WSS end. -->
        <!--WSS else do: 
            
            if iType = 1 then do:
                if lDetails = false then do:
                        run findProcedure.p (input cName, output table ttDetails, input cSystem).-->
                        <div class="container">
                            <div class="form-container">
                                <div class="form-container-buttons">
	                                <form class="buttons form-group" action="front.html" method="POST">
	                                <br>
	                                    <button class="xrefbutton btn btn-primary" type="submit">
	                                    <i class="fa fa-chevron-left"></i> Back</button>
	                                </form>
	                                <form class="buttons form-group" action="front.html" method="POST">
	                                <br>
	                                    <input type="hidden" name="name" value="`cName`">
	                                    <input type="hidden" name="type" value="`iType`">
	                                    <input type="hidden" name="system" value="`cSystem`">
	                                    <input type="hidden" name="details" value="yes">
	                                    <button class="xrefbutton btn btn-primary" type="submit">
	                                    Details</button>
                                    </form>
                                </div>
                                <div class='table-holder'>
					                <h3>Output of <span class="refName">`cName`</span> references (XREF).</h3>
					                <table>
					                    <thead><th>Compile Unit</th></thead>
					                    <!--WSS for each ttDetails: -->
					                    <tr>
					                        <td> `ttDetails.compileUnit` </td>
					                    </tr>
					                    <!--WSS end. -->
    				                </table>
				                </div>
				            </div>
				        </div>
			     <!--WSS end. 
			     else do:
			         run findProcedure_details.p (input cName, output table ttDetails, input cSystem). -->
		                <div class="container">
                            <div class="form-container">
                                <div class="form-container-buttons">
	                                <form class="buttons form-group" action="front.html" method="POST">
	                                <br>
	                                    <button class="xrefbutton btn btn-primary" type="submit">
	                                    <i class="fa fa-chevron-left"></i> Back</button>
	                                </form>
	                                <form class="buttons form-group" action="front.html" method="POST">
	                                <br>
	                                    <input type="hidden" name="name" value="`cName`">
	                                    <input type="hidden" name="type" value="`iType`">
	                                    <input type="hidden" name="system" value="`cSystem`">
	                                    <input type="hidden" name="details" value="no">
	                                    <button class="xrefbutton btn btn-primary" type="submit">
	                                    (Less)</button>
	                                </form>
	                            </div>
                                <div class='table-holder'>
                                    <h3>Output of <span class="refName">`cName`</span> references (XREF). 
                                            Total records: `countEntries(input table ttDetails)`.</h3>
                                    <table>
                                        <thead><th>System</th><th>Compile Unit</th><th>File Name</th><th>Source Path</th><th>Type</th>
                                            <th>Line</th><th>Info</th></thead>
                                        <!--WSS for each ttDetails: -->
                                        <tr>
                                            <td> `ttDetails.system` </td>
                                            <td> `ttDetails.compileUnit` </td>
                                            <td> `ttDetails.fileName` </td>
                                            <td> `ttDetails.sourcePath` </td>
                                            <td> `ttDetails.type` </td>
                                            <td> `ttDetails.line` </td>
                                            <td>
                                                <form>
                                                    <input type="hidden" value="`substring(ttDetails.info, index(ttDetails.info, '/') + 1)`" name="name">
                                                    <input type="hidden" value="1" name="type">
                                                    <input type="hidden" name="system" value="`cSystem`">
                                                    <input type="hidden" value="yes" name="details">
                                                    <input class="infoField" type="submit" value="`ttDetails.info`">
                                                </form>
                                            </td>
                                        </tr>
                                        <!--WSS end. -->
                                    </table>
                                </div>
                            </div>
                        </div>
			         
		          <!--WSS end.
	           end.

            if iType = 2 then do:
                if lDetails = false then do:
                        run findClass.p (input cName, output table ttDetails, input cSystem).-->
                        <div class="container">
                            <div class="form-container">
                                <div class="form-container-buttons">
                                    <form class="buttons form-group" action="front.html" method="POST">
                                    <br>
                                        <button class="xrefbutton btn btn-primary" type="submit">
                                        <i class="fa fa-chevron-left"></i> Back</button>
                                    </form>
                                    <form class="buttons form-group" action="front.html" method="POST">
                                    <br>
                                        <input type="hidden" name="name" value="`cName`">
                                        <input type="hidden" name="type" value="`iType`">
                                        <input type="hidden" name="system" value="`cSystem`">
                                        <input type="hidden" name="details" value="yes">
                                        <button class="xrefbutton btn btn-primary" type="submit">
                                        Details</button>
                                    </form>
                                </div>
                                <div class='table-holder'>
                                    <h3>Output of <span class="refName">`cName`</span> references (XREF).</h3>
                                    <table>
                                        <thead><th>Compile Unit</th></thead>
                                        <!--WSS for each ttDetails: -->
                                        <tr>
                                            <td> `ttDetails.compileUnit` </td>
                                        </tr>
                                        <!--WSS end. -->
                                    </table>
                                </div>
                            </div>
                        </div>
                 <!--WSS end. 
                 else do:
                     run findClass_details.p (input cName, output table ttDetails, input cSystem). -->
                        <div class="container">
                            <div class="form-container">
                                <div class="form-container-buttons">
                                    <form class="buttons form-group" action="front.html" method="POST">
                                    <br>
                                        <button class="xrefbutton btn btn-primary" type="submit">
                                        <i class="fa fa-chevron-left"></i> Back</button>
                                    </form>
                                    <form class="buttons form-group" action="front.html" method="POST">
                                    <br>
                                        <input type="hidden" name="name" value="`cName`">
                                        <input type="hidden" name="type" value="`iType`">
                                        <input type="hidden" name="system" value="`cSystem`">
                                        <input type="hidden" name="details" value="no">
                                        <button class="xrefbutton btn btn-primary" type="submit">
                                        (Less)</button>
                                    </form>
                                </div>
                                <div class='table-holder'>
                                    <h3>Output of <span class="refName">`cName`</span> references (XREF):
                                        Total records: `countEntries(input table ttDetails)`.</h3>
                                    <table>
                                        <thead><th>System</th><th>Compile Unit</th><th>File Name</th><th>Source Path</th><th>Type</th>
                                            <th>Line</th><th>Info</th></thead>
                                        <!--WSS for each ttDetails: -->
                                        <tr>
                                            <td> `ttDetails.system` </td>
                                            <td> `ttDetails.compileUnit` </td>
                                            <td> `ttDetails.fileName` </td>
                                            <td> `ttDetails.sourcePath` </td>
                                            <td> `ttDetails.type` </td>
                                            <td> `ttDetails.line` </td>
                                            <td>
                                                <form>
                                                    <input type="hidden" value="`substring(ttDetails.info, index(ttDetails.info, '/') + 1)`" name="name">
                                                    <input type="hidden" value="2" name="type">
                                                    <input type="hidden" name="system" value="`cSystem`">
                                                    <input type="hidden" value="yes" name="details">
                                                    <input class="infoField" type="submit" value="`ttDetails.info`">
                                                </form>
                                            </td>
                                        </tr>
                                        <!--WSS end. -->
                                    </table>
                                </div>
                            </div>
                        </div>
                     
                  <!--WSS end.
               end.
            
            if iType = 3 then do:
                if lDetails = false then do:
                        run findInclude.p (input cName, output table ttDetails).-->
                        <div class="container">
                            <div class="form-container">
                                <div class="form-container-buttons">
                                    <form class="buttons form-group" action="front.html" method="POST">
                                    <br>
                                        <button class="xrefbutton btn btn-primary" type="submit">
                                        <i class="fa fa-chevron-left"></i> Back</button>
                                    </form>
                                    <form class="buttons form-group" action="front.html" method="POST">
                                    <br>
                                        <input type="hidden" name="name" value="`cName`">
                                        <input type="hidden" name="type" value="`iType`">
                                        <input type="hidden" name="system" value="`cSystem`">
                                        <input type="hidden" name="details" value="yes">
                                        <button class="xrefbutton btn btn-primary" type="submit">
                                        Details</button>
                                    </form>
                                </div>
                                <div class='table-holder'>
                                    <h3>Output of <span class="refName">`cName`</span> references (XREF):
                                        Total records: `countEntries(input table ttDetails)`.</h3>
                                    <table>
                                        <thead><th>Compile Unit</th></thead>
                                        <!--WSS for each ttDetails: -->
                                        <tr>
                                            <td> `ttDetails.compileUnit` </td>
                                        </tr>
                                        <!--WSS end. -->
                                    </table>
                                </div>
                            </div>
                        </div>
                 <!--WSS end. 
                 else do:
                     run findInclude_details.p (input cName, output table ttDetails, input cSystem). -->
                        <div class="container">
                            <div class="form-container">
                                <div class="form-container-buttons">
                                    <form class="buttons form-group" action="front.html" method="POST">
                                    <br>
                                        <button class="xrefbutton btn btn-primary" type="submit">
                                        <i class="fa fa-chevron-left"></i> Back</button>
                                    </form>
                                    <form class="buttons form-group" action="front.html" method="POST">
                                    <br>
                                        <input type="hidden" class="form-control" name="name" value="`cName`">
                                        <input type="hidden" class="form-control" name="type" value="`iType`">
                                        <input type="hidden" name="system" value="`cSystem`">
                                        <input type="hidden" class="form-control" name="details" value="no">
                                        <button class="xrefbutton btn btn-primary" type="submit">
                                        (Less)</button>
                                    </form>
                                </div>
                                <div class='table-holder'>
	                                <h3>Output of <span class="refName">`cName`</span> references (XREF):
	                                   Total records: `countEntries(input table ttDetails)`.</h3>
	                                <table>
	                                    <thead><th>System</th><th>Compile Unit</th><th>File Name</th><th>Source Path</th><th>Type</th>
	                                        <th>Line</th><th>Info</th></thead>
	                                    <!--WSS for each ttDetails: -->
	                                    <tr>
	                                        <td> `ttDetails.system` </td>
	                                        <td> `ttDetails.compileUnit` </td>
	                                        <td> `ttDetails.fileName` </td>
	                                        <td> `ttDetails.sourcePath` </td>
	                                        <td> `ttDetails.type` </td>
	                                        <td> `ttDetails.line` </td>
	                                        <td>
	                                            <form>
	                                                <input type="hidden" value="`substring(ttDetails.info, index(ttDetails.info, '/') + 1)`" name="name">
	                                                <input type="hidden" value="3" name="type">
	                                                <input type="hidden" name="system" value="`cSystem`">
	                                                <input type="hidden" value="yes" name="details">
	                                                <input class="infoField" type="submit" value="`ttDetails.info`">
	                                            </form>
	                                        </td>
	                                    </tr>
	                                    <!--WSS end. -->
	                                </table>
	                            </div>
                            </div>
                        </div>
                     
                  <!--WSS end.
               end.
			

         end. -->
         <a href="javascript:" id="return-to-top"><i class="fa fa-chevron-up"></i></a>

    </body>
</html>

<!-- SCRIPTS: -->

<script type="text/javascript">
$(document).ready(function(){
    $('.invalid-feedback').hide();
    $('#giffy').hide();

    $('#inpType').change(function() {

        if ($(this).val() === '1') {
            $('#inpName').attr("placeholder", "Enter procedure name");
            $('#invFeedbackType').hide();
        };
        if ($(this).val() === '2') {
            $('#inpName').attr("placeholder", "Enter class name");
            $('#invFeedbackType').hide();
        };
        if ($(this).val() === '3') {
            $('#inpName').attr("placeholder", "Enter name fragment of included file");
            $('#invFeedbackType').hide();
        };
        if ($(this).val() === '4') {
            $('#inpName').attr("placeholder", "Enter name of DB field");
            $('#invFeedbackType').hide();
        };
        if ($(this).val() === '5') {
            $('#inpName').attr("placeholder", "Enter index name");
            $('#invFeedbackType').hide();
        };

    });
    $("#xrefForm").submit(function( event ) {
        let fValid = true;

        if ($('#inpName').val() == "") {
            $('#invFeedbackName').show();
            fValid = false;
        };
        if ($('#inpType').val() == "0") {
            $('#invFeedbackType').show();
            fValid = false;
        };
        if (fValid) {
            $('.invalid-feedback').hide();
            if ($('#inpType').val() == "3") {$('#inpDetails').val('yes');};
            $('.outputMessage').text("XREF report of " + $('#inpName').val() + " is being generated...").show().
            return;
        } else {
            event.preventDefault();

        }
    });

    // scroll back to top arrow

    $(window).scroll(function() {
        if ($(this).scrollTop() >= 200) {
            $('#return-to-top').fadeIn(200);
        } else {
            $('#return-to-top').fadeOut(200);
        }
    });
    $('#return-to-top').click(function() {
        $('body,html').animate({
            scrollTop : 0
        }, 500);
    });
    $('#giffy').click(function() {
        $(this).hide();
    });
    $('#logo').click(function() {
        $('#giffy').show();
    });

    let twid = $('table').width();
    let cwid = $('.form-container').width();
    if (twid > cwid) {
        $('.form-container').css('max-width', twid + 80 + 'px');
        $('.form-container').css('width', twid + 80 + 'px');
    };


})

</script>
